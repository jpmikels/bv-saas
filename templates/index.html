<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ryan | Valuation Data Uploader</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    /* ---- Brand palette inspired by ryan.com ---- */
    :root{
      --navy: #0E2A47;
      --navy-600:#153554;
      --navy-700:#0b243c;
      --gold: #C99B2B;
      --gold-700:#a27d1f;
      --ink: #0b1220;
      --card: #0f172a;
      --text: #e7edf6;
      --muted:#9fb1c8;
      --ring: rgba(201,155,43,.35);
      --surface:#0c1a2c;
      --accent:#3FA3D1; /* soft teal accent */
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(900px 500px at 80% -10%, rgba(63,163,209,.15), transparent 60%),
        radial-gradient(1000px 600px at 0% 10%, rgba(201,155,43,.08), transparent 70%),
        linear-gradient(180deg, var(--navy-700) 0%, var(--navy) 100%);
      color:var(--text);
      font:16px/1.55 Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    }

    /* Top bar */
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:16px; padding:14px 22px; border-bottom:1px solid rgba(255,255,255,.07);
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.0));
    }
    .brand{
      display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.2px;
    }
    .logo{
      width:28px; height:28px; border-radius:6px;
      background: radial-gradient(circle at 30% 30%, #fff, #d7ecff 35%, #4aa4ff 35%, #1b65c9 70%, #0b3d78 100%);
      box-shadow: 0 0 0 2px rgba(255,255,255,.12);
    }
    .brand b{color:#fff}
    .brand small{color:var(--muted); font-weight:600}

    .cta-row{display:flex; gap:10px}
    .link{
      color:#fff; text-decoration:none; font-weight:700; font-size:14px;
      padding:8px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.15);
      background:rgba(255,255,255,.04);
    }
    .link:hover{border-color:rgba(255,255,255,.25)}

    /* Main shell */
    .shell{max-width:1060px; margin:28px auto; padding:0 16px}
    .hero{ text-align:center; margin:6px 0 18px }
    .title{
      margin:0 0 8px;
      font-size: clamp(26px, 4vw, 44px);
      line-height:1.1; letter-spacing:.2px; font-weight:800;
      background: linear-gradient(90deg, #fff, #cfe5ff);
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    .subtitle{ color:var(--muted); margin:0 auto; max-width:760px }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));
      border:1px solid rgba(255,255,255,.10);
      border-radius:18px; padding:22px; box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    .grid{display:grid; grid-template-columns: 1.15fr .85fr; gap:18px}
    @media (max-width:900px){ .grid{grid-template-columns:1fr} }

    /* Drop zone */
    .drop{
      border:2px dashed rgba(255,255,255,.20);
      border-radius:14px; padding:24px; text-align:center; background:var(--surface);
      transition:.2s;
    }
    .drop.drag{ border-color: var(--gold); box-shadow: 0 0 0 6px var(--ring) }
    .drop input[type=file]{ display:none }
    .hint{ color:var(--muted); margin:8px 0 12px }
    .badges{ display:flex; flex-wrap:wrap; gap:8px; margin-top:10px }
    .badge{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.16);
      color:#eaf1ff; padding:6px 10px; border-radius:999px; font-size:12px;
      max-width:100%; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
    }

    .btn{
      width:100%; padding:12px 16px; border:none; border-radius:12px; cursor:pointer;
      background: linear-gradient(90deg, var(--gold) 0%, var(--accent) 100%);
      color:#0b1220; font-weight:800; letter-spacing:.2px;
      box-shadow: 0 8px 20px rgba(201,155,43,.25);
    }
    .btn.secondary{
      background: transparent; color:#fff;
      border:1px solid rgba(255,255,255,.18);
    }

    .panel{
      border:1px solid rgba(255,255,255,.12);
      border-radius:14px; padding:16px; background: rgba(12,26,44,.6);
      min-height:110px;
    }
    .panel h4{ margin:0 0 8px; color:var(--gold); font-size:14px; letter-spacing:.3px }

    .progress{height:8px; background:rgba(255,255,255,.12); border-radius:999px; overflow:hidden}
    .bar{height:100%; width:0%; background:linear-gradient(90deg, var(--gold), var(--accent)); transition: width .3s ease}

    .foot{margin-top:14px; text-align:center; color:var(--muted); font-size:12px}
    code{background:rgba(255,255,255,.12); padding:2px 6px; border-radius:6px}
  </style>
</head>
<body>
  <!-- Top bar -->
  <header class="topbar">
    <div class="brand">
      <span class="logo" aria-hidden="true"></span>
      <b>Ryan</b><small>&nbsp;Valuation</small>
    </div>
    <nav class="cta-row">
      <a class="link" href="https://www.ryan.com/practice-areas/income-tax/business-valuation/" target="_blank" rel="noopener">View Insights</a>
      <a class="link" href="https://www.ryan.com/contact/" target="_blank" rel="noopener">Contact Us</a>
    </nav>
  </header>

  <main class="shell">
    <section class="hero">
      <h1 class="title">Valuation Data Uploader</h1>
      <p class="subtitle">Upload multiple PDFs, Excels, or CSVs. We’ll consolidate them into one workbook with tabs for <strong>P&amp;L</strong>, <strong>Balance Sheet</strong>, and <strong>Cash Flow</strong>.</p>
    </section>

    <section class="card">
      <div class="grid">
        <!-- Left: drag & drop -->
        <div>
          <div id="drop" class="drop">
            <p class="hint">Drag & drop files here, or</p>
            <button id="pickBtn" class="btn secondary" type="button">Choose files</button>
            <input id="fileInput" type="file" name="files" multiple accept=".pdf,.xlsx,.xls,.csv" />
            <div id="badges" class="badges"></div>
          </div>

          <div style="margin-top:14px" class="progress" aria-hidden="true">
            <div id="bar" class="bar"></div>
          </div>

          <p class="foot">Max request size ~ <code>32&nbsp;MB</code>. For larger files, we can add Google Cloud Storage uploads.</p>
        </div>

        <!-- Right: status -->
        <div class="panel">
          <h4>Status</h4>
          <pre id="output" style="margin:0; white-space:pre-wrap;"></pre>
        </div>
      </div>

      <div style="margin-top:16px">
        <button id="uploadBtn" class="btn">Upload &amp; Consolidate</button>
      </div>
    </section>
  </main>

  <script>
    const drop = document.getElementById('drop');
    const pickBtn = document.getElementById('pickBtn');
    const uploadBtn = document.getElementById('uploadBtn');
    const fileInput = document.getElementById('fileInput');
    const badges = document.getElementById('badges');
    const output = document.getElementById('output');
    const bar = document.getElementById('bar');

    const setMsg = (m) => output.textContent = m;
    const setProgress = (p) => bar.style.width = Math.max(0, Math.min(100, p)) + '%';
    const resetProgress = () => setProgress(0);

    pickBtn.addEventListener('click', () => fileInput.click());

    ['dragenter','dragover'].forEach(evt => drop.addEventListener(evt, e => {
      e.preventDefault(); e.stopPropagation(); drop.classList.add('drag');
    }));
    ['dragleave','drop'].forEach(evt => drop.addEventListener(evt, e => {
      e.preventDefault(); e.stopPropagation(); drop.classList.remove('drag');
    }));
    drop.addEventListener('drop', e => { fileInput.files = e.dataTransfer.files; renderBadges(); });

    function renderBadges(){
      badges.innerHTML = '';
      const files = fileInput.files;
      if(!files || !files.length){ setMsg('No file selected'); return; }
      [...files].slice(0,12).forEach(f => {
        const b = document.createElement('span');
        b.className = 'badge';
        b.textContent = f.name;
        badges.appendChild(b);
      });
      if(files.length > 12){
        const more = document.createElement('span');
        more.className = 'badge';
        more.textContent = `+${files.length-12} more`;
        badges.appendChild(more);
      }
      setMsg(`${files.length} file${files.length>1?'s':''} ready.`);
    }
    fileInput.addEventListener('change', renderBadges);

    uploadBtn.addEventListener('click', async () => {
      const files = fileInput.files;
      if(!files || !files.length){ setMsg('Pick at least one file.'); return; }

      resetProgress(); setProgress(10);
      setMsg('Uploading & processing…');

      const fd = new FormData();
      for(const f of files) fd.append('files', f);

      try{
        const res = await fetch('/upload', { method: 'POST', body: fd });
        setProgress(70);

        if(!res.ok){
          const text = await res.text();
          throw new Error(text || `HTTP ${res.status}`);
        }
        const blob = await res.blob();
        setProgress(95);

        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'valuation_consolidated.xlsx';
        document.body.appendChild(a); a.click(); a.remove();
        window.URL.revokeObjectURL(url);

        setProgress(100);
        setMsg('✅ Consolidated Excel downloaded.');
      }catch(err){
        resetProgress();
        let msg = err.message;
        try{ const j = JSON.parse(err.message); msg = j.error || err.message; }catch(_){}
        setMsg(`❌ Upload failed: ${msg}`);
      }
    });
  </script>
</body>
</html>
